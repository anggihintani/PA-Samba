// Requires official Node.js MongoDB Driver 3.0.0+
const mongodb = require("mongodb");
const Long = mongodb.Long;

const client = mongodb.MongoClient;
const url = "mongodb://localhost:27017/sensor";

//const geoip = require('geoip-country')

client.connect(url, function (err, client) {
    
    const db = client.db("sensor");
    const collection = db.collection("dionaeaembedded2");
    
    const options = {
        allowDiskUse: true
    };
    
    const pipeline = [
        {
            $match: {
                local_port: Long.fromString("445")
            }
        },
        {
            $group: {
              _id: { 
                  remote_host: "$remote_host"
                }
              }
          },
    ];
    
    const cursor = collection.countDocuments(pipeline, options);
    
    console.log(cursor);
    
    // Created with Studio 3T, the IDE for MongoDB - https://studio3t.com/
    
});
